from Crypto.Util.number import *
from gmpy2 import *
from random import *

flag = b'flag{xxxxxxxxxxxxxxx}'
m = bytes_to_long(flag)
p = getPrime(1024)
q = getPrime(1024)
n = p * q
e1 = randint(1, 65538)
e2 = 9647291
assert gcd(e1, e2) == 1

c1 = pow(m, e1, n)
c2 = pow(m, e2, n)

a = randint(n // 2, n)
b = randint(n // 2, n)
x = randint(n // 2, n)
hint1 = (a * c1 + 1023 * x) % n
hint2 = (b * c1 + 1024 * x) % n
hint3 = c2 * n


print('n =', n)
print("a =", a)
print("b =", b)
print("hint1 =", hint1)
print("hint2 =", hint2)
print("hint3 =", hint3)
# n = 16125407552864408038451978971181995868587415471360339980312161114604643561448189461178314426572196867330062460236485889607095216773610462673103525772850249723607127265156082437903554965291175082962639383670937777311212896542972880424526079735786844389686957083365598937203322023931600269428448046149266341128554306213612397973685363189571686506630309830089220474201802073858959449101463678487317186076440791650250365012789827421324921778250883488990582944368562892797416344251060566529139850257746842799863322714616986446835293581697909698285176760388107157669554377276259762618665488257388491160075176338147719827037
# a = 13322099359978468117372945784425510444699489610016328757147661948295406516253823721585011191447575070678806499049706999293540250271665120018677590850034030368730195727460200565297326051740643004879691301619699301106930837198015487978219038035197723076156409255613823021037443587984496717728543374662454371480847535762439189824812004916125039891869564141181736162482872749048932562058201189900746478873842107591299649081305019213582364534953875369121945643746097376620917802772688252466567153568522092062992030417712736678853318751806058050273319844033309624611135341470435429322414596904369077559157148448414839032363
# b = 10275112473052097822163214291710245927601932098450526023436146936515575568966157279003404407528918111137316033319928861357294023493650299285411997308906967017629349471597059845459569991332848036825641333607579647087347485564553165670865364947248868251173085509024531668592291055640081009491476771331141299698791088908862211221687025549332282038419404819610705192095183951267650322294156121830068680857085069554177406709624092077033969271498007410828074096659664006111360389535517799171965089132885207983699725930677229877112464611768708080016125996142926911506613455696889598916644316886658721740850065556243938007810
# hint1 = 5646585199324712910174870876537963922935541552960135665854448183261083672983331653471842641925332927782315514511532766879190801929980994592200158530247219526312018092215417868738295218479822713259089033062819804918266548266840411490391265219709570414166619339434539050638762944531192598576491596621743816843125895668542438923918478344982739955475060988594676093550481119457143084943131533380243144975602778461714997734422024740849870491507544447233405634629786945527801001275734833662623467945946282795996306293408310273736674209426457392716416888243874745568105752845915237400340094943662551705685040442624941385833
# hint2 = 14585520416190000580445268935877639341764643969476248446269709488912338827970488844346831212422329420900792189527752187774994153342996351962929221182898317644166070626979324794061661833397604017568609862262727324814815424928736663001245135821828306087205636823484794573005890510152188674905462762148100329985991698959636488617249906898501964648111982813010371107696317126789702686935854736324220969771123819040020121221332632913284083499130218851636149172445983987305390603339306926120007456352189098000654123268951023801063278397184055390984864816637614344524008267690049801207931569396692120561972519603849989128993
# hint3 = 62093942844955894809744369157790919272709918861758380679821577778048849347738275395666159786314235217854818169109692941511405178089534902688354311428283671061156522101189015915319595816373429513381246644721630263218045931797340921607548704947248385584064891710829013112219974267785184786002337877737639709838592212626216662132226423917011307673560256826430488539866716857680736031883178590790995624532262186067634107387809349232152735759985335934241188954392212538014367792568155050961352578224455757803682195904635225691590570030418963654743371040135500179324783700281415394891744127799547005015135086532660545095391079521112740890332419993624820181300060863161311031709022851421455500566323115875683812425673042153124072114571960643827025713430499560735327945430769108097870643289355930786864376038045754477540741831426313486186208377194724677735876320331562117490978784291302590568890413248378029250309728695855535870140308467228980587481032478718831718081368010375598581706830265936563271354286383793280590954702836704366205681837777194310753890918642427863999918174783991318434802104950572826848043286819209577713010622615357988184856985035869968426847979577245836140860190327001050885833097619703928776547085778778592553120373



from Crypto.Util.number import *
import gmpy2


n = 16125407552864408038451978971181995868587415471360339980312161114604643561448189461178314426572196867330062460236485889607095216773610462673103525772850249723607127265156082437903554965291175082962639383670937777311212896542972880424526079735786844389686957083365598937203322023931600269428448046149266341128554306213612397973685363189571686506630309830089220474201802073858959449101463678487317186076440791650250365012789827421324921778250883488990582944368562892797416344251060566529139850257746842799863322714616986446835293581697909698285176760388107157669554377276259762618665488257388491160075176338147719827037
a = 13322099359978468117372945784425510444699489610016328757147661948295406516253823721585011191447575070678806499049706999293540250271665120018677590850034030368730195727460200565297326051740643004879691301619699301106930837198015487978219038035197723076156409255613823021037443587984496717728543374662454371480847535762439189824812004916125039891869564141181736162482872749048932562058201189900746478873842107591299649081305019213582364534953875369121945643746097376620917802772688252466567153568522092062992030417712736678853318751806058050273319844033309624611135341470435429322414596904369077559157148448414839032363
b = 10275112473052097822163214291710245927601932098450526023436146936515575568966157279003404407528918111137316033319928861357294023493650299285411997308906967017629349471597059845459569991332848036825641333607579647087347485564553165670865364947248868251173085509024531668592291055640081009491476771331141299698791088908862211221687025549332282038419404819610705192095183951267650322294156121830068680857085069554177406709624092077033969271498007410828074096659664006111360389535517799171965089132885207983699725930677229877112464611768708080016125996142926911506613455696889598916644316886658721740850065556243938007810
hint1 = 5646585199324712910174870876537963922935541552960135665854448183261083672983331653471842641925332927782315514511532766879190801929980994592200158530247219526312018092215417868738295218479822713259089033062819804918266548266840411490391265219709570414166619339434539050638762944531192598576491596621743816843125895668542438923918478344982739955475060988594676093550481119457143084943131533380243144975602778461714997734422024740849870491507544447233405634629786945527801001275734833662623467945946282795996306293408310273736674209426457392716416888243874745568105752845915237400340094943662551705685040442624941385833
hint2 = 14585520416190000580445268935877639341764643969476248446269709488912338827970488844346831212422329420900792189527752187774994153342996351962929221182898317644166070626979324794061661833397604017568609862262727324814815424928736663001245135821828306087205636823484794573005890510152188674905462762148100329985991698959636488617249906898501964648111982813010371107696317126789702686935854736324220969771123819040020121221332632913284083499130218851636149172445983987305390603339306926120007456352189098000654123268951023801063278397184055390984864816637614344524008267690049801207931569396692120561972519603849989128993
hint3 = 62093942844955894809744369157790919272709918861758380679821577778048849347738275395666159786314235217854818169109692941511405178089534902688354311428283671061156522101189015915319595816373429513381246644721630263218045931797340921607548704947248385584064891710829013112219974267785184786002337877737639709838592212626216662132226423917011307673560256826430488539866716857680736031883178590790995624532262186067634107387809349232152735759985335934241188954392212538014367792568155050961352578224455757803682195904635225691590570030418963654743371040135500179324783700281415394891744127799547005015135086532660545095391079521112740890332419993624820181300060863161311031709022851421455500566323115875683812425673042153124072114571960643827025713430499560735327945430769108097870643289355930786864376038045754477540741831426313486186208377194724677735876320331562117490978784291302590568890413248378029250309728695855535870140308467228980587481032478718831718081368010375598581706830265936563271354286383793280590954702836704366205681837777194310753890918642427863999918174783991318434802104950572826848043286819209577713010622615357988184856985035869968426847979577245836140860190327001050885833097619703928776547085778778592553120373
e2 = 9647291
c2 = hint3//n
c1 = ((1024*hint1-1023*hint2)*gmpy2.invert(1024*a-1023*b,n)) % n
for e1 in range(1,65539):
    if gmpy2.gcd(e1,e2)==1:
        g,s1,s2 = gmpy2.gcdext(e1,e2)
        m = pow(c1,s1,n)*pow(c2,s2,n)%n
        flag = long_to_bytes(m)
        if b'flag' in flag:
            print(f'e1 = {e1}')
            print(flag)
            break
    else:
        pass
